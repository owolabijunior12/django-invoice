 {% load static %}

<!doctype html>
<html lang="en" class="h-full antialiased">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Iboy Technology Invoicing System — Create your own invoice online">
    <meta name="author" content="Iboy Technology">
    <title>{% block title %}Iboy Technology{% endblock %}</title>

    {# --- Tailwind (CDN for quick preview). For production, use your compiled CSS instead. --- #}
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // optional: extend Tailwind config (colors/containers/etc)
      tailwind.config = {
        theme: {
          extend: {
            container: { center: true, padding: "1rem" }
          }
        },
        darkMode: 'class'
      }
    </script>

    {# Optional icon font - comment out if not needed #}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    {# page-level CSS hook #}
    {% block css %}{% endblock %}
  </head>

  <body class="h-full bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-100">
    <!-- App shell -->
    <div x-data="layout()" x-init="init()" class="min-h-screen" x-cloak>
      <!-- Top nav -->
      <header class="sticky top-0 z-40 border-b border-slate-200 bg-white/90 backdrop-blur dark:border-slate-800 dark:bg-slate-900/80">
        <div class="mx-auto flex h-14 items-center justify-between gap-3 px-4">
          <div class="flex items-center gap-2">
            <!-- mobile sidebar toggle -->
            <button @click="sidebarOpen = true"
                    class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-slate-200 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:hover:bg-slate-800 md:hidden"
                    aria-label="Open menu">
              <i class="fa-solid fa-bars"></i>
            </button>

            <a href="{% url 'dashboard' %}" class="inline-flex items-center gap-2 font-semibold tracking-tight text-slate-900 dark:text-white">
              <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600 text-white">IT</span>
              <span class="hidden sm:inline">Iboy Technology</span>
            </a>
          </div>

          <!-- search -->
          <form class="relative hidden w-full max-w-lg md:block" role="search" action="#" method="get">
            <i class="fa-solid fa-magnifying-glass pointer-events-none absolute left-3 top-2.5 text-slate-400"></i>
            <input type="text" name="q" placeholder="Search…"
                   class="w-full rounded-lg border border-slate-300 bg-white pl-9 pr-3 py-2 text-sm placeholder-slate-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950" />
          </form>

          <!-- right actions -->
          <div class="flex items-center gap-2">
            <button @click="toggleDark()"
                    class="hidden rounded-lg border border-slate-200 px-3 py-2 text-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:hover:bg-slate-800 sm:inline-flex"
                    :aria-pressed="darkMode ? 'true' : 'false'">
              <i class="fa-solid" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
            </button>
            <a href="{% url 'logout' %}"
               class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-white">
              <i class="fa-solid fa-right-from-bracket"></i>
              <span class="hidden sm:inline">Log Out</span>
            </a>
          </div>
        </div>

        <!-- mobile search -->
        <div class="px-4 pb-3 md:hidden">
          <form class="relative" role="search" action="#" method="get">
            <i class="fa-solid fa-magnifying-glass pointer-events-none absolute left-3 top-2.5 text-slate-400"></i>
            <input type="text" name="q" placeholder="Search…"
                   class="w-full rounded-lg border border-slate-300 bg-white pl-9 pr-3 py-2 text-sm placeholder-slate-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-950" />
          </form>
        </div>
      </header>

      <!-- Layout: sidebar + content -->
      <div class="mx-auto flex">
        <!-- Sidebar (desktop) -->
        <aside class="sticky top-14 hidden h-[calc(100vh-3.5rem)] w-64 shrink-0 border-r border-slate-200 bg-white/70 px-3 py-4 dark:border-slate-800 dark:bg-slate-900/60 md:block">
          <nav class="space-y-6">
            <div>
              <ul class="space-y-1 text-sm">
                <li>
                  <a href="{% url 'dashboard' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800">
                    <i class="fa-solid fa-gauge-high w-5 text-slate-500"></i>
                    <span>Dashboard</span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'invoices' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800">
                    <i class="fa-solid fa-file-invoice-dollar w-5 text-slate-500"></i>
                    <span>Invoices</span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'products' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800">
                    <i class="fa-solid fa-cart-shopping w-5 text-slate-500"></i>
                    <span>Products / Services</span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'clients' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800">
                    <i class="fa-solid fa-users w-5 text-slate-500"></i>
                    <span>Clients</span>
                  </a>
                </li>
              </ul>
            </div>

            <div>
              <div class="px-3 text-xs font-semibold uppercase tracking-wider text-slate-400">Settings</div>
              <ul class="mt-2 space-y-1 text-sm">
                <li>
                  <a href="{% url 'company-settings' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800">
                    <i class="fa-solid fa-building w-5 text-slate-500"></i>
                    <span>Company</span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'logout' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800">
                    <i class="fa-solid fa-right-from-bracket w-5 text-slate-500"></i>
                    <span>Logout</span>
                  </a>
                </li>
              </ul>
            </div>
          </nav>
        </aside>

        <!-- Drawer sidebar (mobile) -->
        <div x-show="sidebarOpen" @keydown.escape.window="sidebarOpen = false" class="md:hidden">
          <div @click="sidebarOpen = false" class="fixed inset-0 z-40 bg-black/40"></div>
          <aside class="fixed inset-y-0 left-0 z-50 w-72 border-r border-slate-200 bg-white px-3 py-4 dark:border-slate-800 dark:bg-slate-900">
            <div class="mb-4 flex items-center justify-between px-1">
              <span class="font-semibold">Menu</span>
              <button @click="sidebarOpen = false" class="rounded-lg p-2 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:hover:bg-slate-800">
                <i class="fa-solid fa-xmark"></i>
                <span class="sr-only">Close menu</span>
              </button>
            </div>
            <nav class="space-y-6">
              <ul class="space-y-1 text-sm">
                <li><a href="{% url 'dashboard' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800"><i class="fa-solid fa-gauge-high w-5 text-slate-500"></i>Dashboard</a></li>
                <li><a href="{% url 'invoices' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800"><i class="fa-solid fa-file-invoice-dollar w-5 text-slate-500"></i>Invoices</a></li>
                <li><a href="{% url 'products' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800"><i class="fa-solid fa-cart-shopping w-5 text-slate-500"></i>Products / Services</a></li>
                <li><a href="{% url 'clients' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800"><i class="fa-solid fa-users w-5 text-slate-500"></i>Clients</a></li>
              </ul>
              <div>
                <div class="px-3 text-xs font-semibold uppercase tracking-wider text-slate-400">Settings</div>
                <ul class="mt-2 space-y-1 text-sm">
                  <li><a href="{% url 'company-settings' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800"><i class="fa-solid fa-building w-5 text-slate-500"></i>Company</a></li>
                  <li><a href="{% url 'logout' %}" class="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800"><i class="fa-solid fa-right-from-bracket w-5 text-slate-500"></i>Logout</a></li>
                </ul>
              </div>
            </nav>
          </aside>
        </div>

        <!-- Main content -->
        <main id="content" class="flex-1 px-4 py-6 md:px-8">
          <!-- flash messages -->
          {% if messages %}
            <div class="mb-4 space-y-3">
              {% for message in messages %}
                {% with tag=message.tags %}
                <div role="alert"
                     class="relative rounded-lg border px-4 py-3 text-sm
                     {% if 'error' in tag or 'danger' in tag %}
                       border-rose-200 bg-rose-50 text-rose-800 dark:border-rose-900/50 dark:bg-rose-900/20 dark:text-rose-200
                     {% elif 'success' in tag %}
                       border-emerald-200 bg-emerald-50 text-emerald-800 dark:border-emerald-900/50 dark:bg-emerald-900/20 dark:text-emerald-200
                     {% elif 'warning' in tag %}
                       border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-900/50 dark:bg-amber-900/20 dark:text-amber-200
                     {% else %}
                       border-slate-200 bg-white text-slate-800 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200
                     {% endif %}">
                  <div class="flex items-start gap-3">
                    <i class="fa-solid
                      {% if 'error' in tag or 'danger' in tag %} fa-circle-xmark
                      {% elif 'success' in tag %} fa-circle-check
                      {% elif 'warning' in tag %} fa-circle-exclamation
                      {% else %} fa-circle-info
                      {% endif %} mt-[2px]"></i>
                    <div>{{ message }}</div>
                  </div>
                </div>
                {% endwith %}
              {% endfor %}
            </div>
          {% endif %}

          {% block main %}{% endblock %}
        </main>
      </div>
    </div>

    {# --- Scripts --- #}
    <script>
      // super tiny "alpine-like" helpers without dependencies
      function layout() {
        return {
          sidebarOpen: false,
          darkMode: false,
          init() {
            // restore dark preference
            const stored = localStorage.getItem('theme');
            this.darkMode = stored ? stored === 'dark' : window.matchMedia('(prefers-color-scheme: dark)').matches;
            this.applyDark();
          },
          toggleDark() {
            this.darkMode = !this.darkMode;
            this.applyDark();
          },
          applyDark() {
            const c = document.documentElement.classList;
            this.darkMode ? c.add('dark') : c.remove('dark');
            localStorage.setItem('theme', this.darkMode ? 'dark' : 'light');
          }
        }
      }
    </script>

    {# page-level scripts hook #}
    {% block scripts %}{% endblock %}
  </body>
</html>
