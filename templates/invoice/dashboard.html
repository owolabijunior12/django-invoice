 {% extends 'partials/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block main %}
<div class="mx-auto max-w-7xl px-4 py-6">
  <!-- header -->
  <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-slate-900 dark:text-slate-100">Dashboard</h1>
      <p class="mt-1 text-slate-600 dark:text-slate-400">Quick overview of invoices and clients.</p>
    </div>
    <div class="flex flex-wrap items-center gap-2">
      <a href="{% url 'invoices' %}"
         class="inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow ring-1 ring-blue-700/30 transition hover:translate-y-[1px] hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <i class="fa-solid fa-file-invoice"></i> View Invoices
      </a>
      <a href="{% url 'clients' %}"
         class="inline-flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800">
        <i class="fa-solid fa-users"></i> View Clients
      </a>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
    <!-- Left: KPI / Cards -->
    <div class="space-y-6">
      <!-- Invoices card -->
      <section class="overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"
               id="invoiceCard"
               data-invoices="{{ invoices|default:0 }}"
               data-paid="{{ paidInvoices|default:0 }}">
        <div class="border-b border-slate-200 px-5 py-3 text-sm font-medium text-slate-800 dark:border-slate-800 dark:text-slate-200">
          Invoices
        </div>
        <div class="p-5">
          <div class="grid grid-cols-1 gap-6 sm:grid-cols-3">
            <div class="rounded-lg border border-slate-200 p-4 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <span class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">Total</span>
                <i class="fa-solid fa-file-invoice text-slate-400"></i>
              </div>
              <div class="mt-1 text-2xl font-semibold text-slate-900 dark:text-slate-100">{{ invoices|default:"0" }}</div>
            </div>

            <div class="rounded-lg border border-slate-200 p-4 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <span class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">Paid</span>
                <i class="fa-solid fa-circle-check text-emerald-500"></i>
              </div>
              <div class="mt-1 text-2xl font-semibold text-slate-900 dark:text-slate-100">{{ paidInvoices|default:"0" }}</div>
            </div>

            <div class="rounded-lg border border-slate-200 p-4 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <span class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">Unpaid</span>
                <i class="fa-solid fa-clock text-amber-500"></i>
              </div>
              <div class="mt-1 text-2xl font-semibold text-slate-900 dark:text-slate-100">
                {% comment %} {{ invoices|default:0|add:-paidInvoices|default:0 }} {% endcomment %}
              </div>
            </div>
          </div>

          <!-- progress -->
          <div class="mt-6">
            <div class="mb-1 flex items-center justify-between text-xs text-slate-500 dark:text-slate-400">
              <span>Paid Percentage</span>
              <span id="paidPctLabel">0%</span>
            </div>
            <div class="h-2 w-full rounded-full bg-slate-100 dark:bg-slate-800">
              <div id="paidPctBar" class="h-2 rounded-full bg-emerald-500 transition-all" style="width: 0%"></div>
            </div>
          </div>

          <div class="mt-6 flex flex-wrap gap-2">
            <a href="{% url 'invoices' %}"
               class="inline-flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800">
              <i class="fa-solid fa-list"></i> View all
            </a>
            <a href="{% url 'invoices' %}"
               class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <i class="fa-solid fa-plus"></i> New invoice
            </a>
          </div>
        </div>
      </section>

      <!-- Clients card -->
      <section class="overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900">
        <div class="border-b border-slate-200 px-5 py-3 text-sm font-medium text-slate-800 dark:border-slate-800 dark:text-slate-200">
          Clients
        </div>
        <div class="p-5">
          <div class="flex items-center gap-4">
            <div class="grid h-12 w-12 place-items-center rounded-lg bg-blue-50 dark:bg-blue-900/30">
              <i class="fa-solid fa-users text-blue-600 dark:text-blue-300"></i>
            </div>
            <div>
              <p class="text-sm text-slate-500 dark:text-slate-400">Total number of clients</p>
              <p class="text-2xl font-semibold text-slate-900 dark:text-slate-100">{{ clients|default:"0" }}</p>
            </div>
          </div>

          <div class="mt-6 flex flex-wrap gap-2">
            <a href="{% url 'clients' %}"
               class="inline-flex items-center gap-2 rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800">
              <i class="fa-solid fa-address-book"></i> View clients
            </a>
            <a href="{% url 'clients' %}"
               class="inline-flex items-center gap-2 rounded-md bg-slate-900 px-3 py-1.5 text-sm font-medium text-white hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-white">
              <i class="fa-solid fa-user-plus"></i> Add client
            </a>
          </div>
        </div>
      </section>
    </div>

    <!-- Right: Illustration / Empty state -->
    <div class="flex items-center justify-center">
      <div class="text-center p-6">
        <img src="{% static 'assets/img/empty.svg' %}" alt="Dashboard Illustration"
             class="mx-auto mb-4 h-48 w-auto opacity-90 dark:opacity-80">
        <p class="text-slate-500 dark:text-slate-400">More insights and charts will appear here soon.</p>
      </div>
    </div>
  </div>
</div>

<!-- tiny script to compute paid % -->
<script>
  (function(){
    const card = document.getElementById('invoiceCard');
    if (!card) return;
    const total = Number(card.dataset.invoices || 0);
    const paid  = Number(card.dataset.paid || 0);
    const pct = total > 0 ? Math.min(100, Math.round((paid / total) * 100)) : 0;
    const bar = document.getElementById('paidPctBar');
    const lbl = document.getElementById('paidPctLabel');
    if (bar) bar.style.width = pct + '%';
    if (lbl) lbl.textContent = pct + '%';
  })();
</script>
{% endblock %}
